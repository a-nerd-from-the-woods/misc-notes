# Practical Malware Analysis Essentials for Incident Responders by Lenny Zeltser

[Video Link](https://www.youtube.com/watch?v=20xYpxe8mBg)

## Inital Driving Questions
The Goal of malware analysis is to answer these questions:
* Does the file pose a threat to your organization?
* What capabilities does the file have?
* How can I detect this malware/file on other systems acress the organization?
* What does the file reveal about its creator/your adversary?
  * Malware is just a tool that is being used by someone else, there is always a human being behind it and, more importantly, a goal.

## Methods of Analysis
1. Fully-Automated Analysis (running file through virus scanner/analyzer)
2. Static properties analysis (manually analyzing file using [PeStudio](https://www.winitor.com/))
3. Interactive behavior analysis: (executing the file in a VM made to do so)
4. Manual code review: (reading the file line by line in a text editor)

## Static Properties Analysis
1. What is the file's hashes? --> [Virus Total](https://www.virustotal.com/gui/) & [Total Hash](https://totalhash.cymru.com/)
2. What is the packer identifier? --> Most programs on Windows are not self-sufficient and require the assistance of Windows .dll files. Most normal files need at least 5-8 .dll files, having less is considered a red flag. 
5. What are the embedded artifacts?
6. What is the file importing and exporting?
* Normal files usually have a very long list of functions that the program declares it wants to use. Having none or very few is a red flag combined with the function VirtualAlloc.
* Accessing disk and cryptography would suggest that the file is ransomware.
* The function “VirtualAlloc” is often used by malware to extract the actual code, and it indicates the existence of packers.
  * Packers is short for “runtime packers” which are also known as “self-extracting archives”.

5. What human readable strings do you have?
  * Having no human readable strings in a file is unusual.

### Working towards these questions
* Is it malware?
* How bad is it?
* How do we detect it?

## Interactive Behavior Analysis
This type of analysis is used to examine how the file interacts with a test environment.

* Excute the file in an isolated lab system (sandbox) environment
* Observe what it interacts with, and how (file system, registry, network)
* Interact with the file to learn more about it
### The Sandbox Environment
#### Options
1. Build your own VM from Scratch 
2. Download a Windows VM from [Microsoft](https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/)
3. Download [Flare-VM](https://github.com/mandiant/flare-vm)
#### Keeping the Sandbox Contained
* Avoid a Network connection
* Dedicate a single phyical host for lab VMs
* Restore the host if anything suspicious occurs
* Keep virtualization software up to date

#### Detonating the Malware
Have monitoring software running in the background.

* Process Hacker (or Process Explorer) - extracts human-readable strings from the running process, which may give you insight into the malware itself.
* Process Monitor - records local system interactions
* ProcDOT - Cleans up and displeys Process Monitor's data
* Wireshark - records network activity

More often than not, the malware will start running after the next system reboot, so it will generate a key on the registery. It's goal is to blend in, so it will be named something that looks normal.

Malware will also often use Mutex/Mutant to signal to itself that it is installed on the system inorder to avoid infecting the system again. 

Once you aquire more peices of information (i.e. an IP, or Mutex/Mutant handle), be sure to reqord it in your knowleage base.

## Additional Resources
1. [Linux Malware Analysis toolkit distro](https://remnux.org/)
2. [URLVoid](https://www.urlvoid.com/) - Used to check if websites are malicious or safe. 

# Malware Analysis by Information Security Club UCalgary 

* [Part 1](https://www.youtube.com/watch?v=d4d8VRsk4-0)
* [Part 2](https://www.youtube.com/watch?v=Gm9rzqM_RJk)


